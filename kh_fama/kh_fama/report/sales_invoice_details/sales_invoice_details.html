<style>
    @media print {
        .page-number:after {
            content: counter(page);
        }
    }

    @page {
        size: A4 portrait;
        margin: 20mm;
    }

    body {
        font-family: "Helvetica", sans-serif;
        font-size: 10pt;
        color: #000;
    }

    .header {
        text-align: left;
        margin-bottom: 10px;
    }

    .header h2 {
        margin: 0;
        font-size: 13pt;
        font-weight: bold;
    }

    .sub-header {
        font-size: 10pt;
    }

    .top-right {
        position: absolute;
        top: 2mm;
        right: 2mm;
        text-align: right;
        font-size: 12px;
        line-height: 1.4;
    }

    table {
        width: 100%;
        border-collapse: collapse;
        margin-top: 3px;
    }

    th {
        border: 1px solid #000;
        background-color: #f0f0f0;
        text-align: center;
        font-weight: bold;
        padding: 2px 3px;
        font-size: 9pt;
    }

    td {
        border: none;
        padding: 2px 3px;
        text-align: right;
        font-size: 9pt; 
        line-height: 1.1;
    }

    td:first-child, th:first-child {
        text-align: left;
    }

    /* Customer Name Row */
    .party-header {
        font-weight: bold;
        font-size: 9pt;
        text-align: left;
        border: none;
        padding-top: 10px;
        
    }

    /* "18%" Row */
    .tax-row {
        font-weight: bold;
        text-align: right;
        border: none;
        font-size: 9pt;
    }

    /* Party Total Row (Right side borders only) */
    .party-total-row td {
        font-weight: bold;
        font-size: 9pt;
    }

    .party-total-row td:nth-child(n+2) {
        border-top: 2px solid #000;
        border-bottom: 2px solid #000;
    }

    /* Grand Total Row (Right side borders only) */
    .grand-total-row td {
        font-weight: bold;
        font-size: 9pt;
    }

    .grand-total-row td:nth-child(n+2) {
        border-top: 2px solid #000;
        border-bottom: 2px solid #000;
    }
</style>

<div class="header">
    <h2>K. H. FAMA Textile Processing (Pvt.) Ltd.</h2>
    <div class="sub-header">
        <strong>Sales Invoice Listing</strong><br>
        Party-wise From 
        {{ frappe.datetime.str_to_user(filters.from_date).split("-").reverse().join("-") }} 
        To {{ frappe.datetime.str_to_user(filters.to_date).split("-").reverse().join("-") }}
    </div>
</div>

<div style="text-align: right; font-size: 11px; margin-top: auto;">
    
    <strong>Date:</strong> {{ frappe.datetime.str_to_user(frappe.datetime.get_today()) }}
</div>

<table>
    <thead>
        <tr>
            <th style = "width : 8%;">Date</th>
            <th style = "width : 15%;">Invoice # / Customer</th>
            <th style = "width : 8%;">Bill #</th>
            <th style = "width : 18%;">Garment</th>
            <th style = "width : 10%;">Style</th>
            <th style = "width : 5%;">Qty</th>
            <th style = "width : 8%;">Rate</th>
            <th style = "width : 10%;">Amount</th>
            <th style = "width : 10%;">Sales Tax</th>
            <th style = "width : 10%;">Total</th>
        </tr>
    </thead>

    <tbody>
        {% for (var i = 0; i < data.length; i++) { %}
            {% var row = data[i]; %}

            <!-- Customer Name Row -->
            {% if (row.link_doctype == "Customer") { %}
                <tr>
                    
                    <td colspan = "4" class="party-header">{{ row.invoice_no }}</td>
                    
                    
                    <td></td>
                    <td></td>
                    <td></td>
                    <td class="tax-row">18.00%</td>
                </tr>
            {% } %}

            <!-- Normal Invoice Rows -->
            {% if (row.garment != "Party Total" && row.garment != "Grand Total" && row.link_doctype != "Customer") { %}
                <tr>
                    <td style="text-align:left;">{{ row.date ? row.date.split("-").reverse().join("-") : "" }}</td>
                    <td style="text-align:left;">{{ row.invoice_no }}</td>
                    <td style="text-align:left;">{{ row.bill_no }}</td>
                    <td style="text-align:left;">{{ row.garment }}</td>
                    <td style="text-align:left;">{{ row.custom_style }}</td>
                    <td style="text-align:left;">{{ (row.qty || 0).toLocaleString() }}</td>
                    <td style="text-align:left;">{{ (row.rate || 0).toLocaleString(undefined, {minimumFractionDigits:2}) }}</td>
                    <td style="text-align:left;">{{ (row.amount || 0).toLocaleString(undefined, {minimumFractionDigits:2}) }}</td>
                    <td style="text-align:left;">{{ (row.sales_tax || 0).toLocaleString(undefined, {minimumFractionDigits:2}) }}</td>
                    <td style="text-align:left;">{{ (row.total || 0).toLocaleString(undefined, {minimumFractionDigits:2}) }}</td>
                </tr>
            {% } %}

            <!-- Party Total Row -->
            {% if (row.garment == "Party Total") { %}
                <tr class="party-total-row">
                    <td colspan="5" style="text-align:right;">Party Total:</td>
                    <td style="text-align:left;">{{ (row.qty || 0).toLocaleString() }}</td>
                    <td style="text-align:left;"></td>
                    <td style="text-align:left;">{{ (row.amount || 0).toLocaleString(undefined, {minimumFractionDigits:2}) }}</td>
                    <td style="text-align:left;">{{ (row.sales_tax || 0).toLocaleString(undefined, {minimumFractionDigits:2}) }}</td>
                    <td style="text-align:left;">{{ (row.total || 0).toLocaleString(undefined, {minimumFractionDigits:2}) }}</td>
                </tr>
            {% } %}

            <!-- Grand Total Row -->
            {% if (row.garment == "Grand Total") { %}
                <tr class="grand-total-row">
                    <td colspan="5" style="text-align:right;">Grand Total:</td>
                    <td style="text-align:left;">{{ (row.qty || 0).toLocaleString() }}</td>
                    <td style="text-align:left;"></td>
                    <td style="text-align:left;">{{ (row.amount || 0).toLocaleString(undefined, {minimumFractionDigits:2}) }}</td>
                    <td style="text-align:left;">{{ (row.sales_tax || 0).toLocaleString(undefined, {minimumFractionDigits:2}) }}</td>
                    <td style="text-align:left;">{{ (row.total || 0).toLocaleString(undefined, {minimumFractionDigits:2}) }}</td>
                </tr>
            {% } %}
        {% } %}
    </tbody>
</table>
